version: "3.9"

services:
  # ==========
  # Postgres Ø¨Ø±Ù†Ø§Ù…Ù‡ Û²
  # ==========
  anbalya_postgres:
    image: postgres:16-alpine
    container_name: anbalya-postgres
    restart: unless-stopped
    environment:
      POSTGRES_USER: tourAntalya
      POSTGRES_PASSWORD: 12sina122
      POSTGRES_DB: TourAntalya
    volumes:
      - anbalya_pgdata:/var/lib/postgresql/data
    # Ø§Ú¯Ø± Ø®ÙˆØ§Ø³ØªÛŒ Ø§Ø² Ø¨ÛŒØ±ÙˆÙ† Ù‡Ù… Ø¨Ù‡ DB ÙˆØµÙ„ Ø´ÙˆÛŒ (Ù…Ø«Ù„Ø§Ù‹ Ø¨Ø§ DBeaver Ø§Ø² Ù„Ù¾â€ŒØªØ§Ù¾):
    # Ù¾ÙˆØ±Øª Ø±Ø§ Ø¨Ø§Ø² Ú©Ù† ÙˆÙ„ÛŒ Ø±ÙˆÛŒ 5433 Ú©Ù‡ Ø¨Ø§ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø§ÙˆÙ„ Ø¯Ø¹ÙˆØ§ Ù†Ú©Ù†Ø¯
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U anbalya_user -d AnbalyaDb"]
      interval: 5s
      timeout: 5s
      retries: 10

  # ==========
  # pgAdmin Ù…Ø®ØµÙˆØµ Ù‡Ù…ÛŒÙ† Ø¨Ø±Ù†Ø§Ù…Ù‡ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
  # ==========
  anbalya_pgadmin:
    image: dpage/pgadmin4:9.8
    container_name: anbalya-pgadmin
    depends_on:
      - anbalya_postgres
    environment:
      PGADMIN_DEFAULT_EMAIL: "anbalya.admin@example.com"
      PGADMIN_DEFAULT_PASSWORD: "admin123"
    ports:
      - "5051:80"    # ğŸ‘ˆ Ú†ÙˆÙ† Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø§ÙˆÙ„ Ø§Ø­ØªÙ…Ø§Ù„Ø§ 5050 Ø±Ùˆ Ú¯Ø±ÙØªÙ‡
    restart: unless-stopped

  # ==========
  # ÙˆØ¨ ASP.NET (Anbalya)
  # ==========
  anbalya_web:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: anbalya-web
    restart: unless-stopped
    depends_on:
      - anbalya_postgres
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
      - ASPNETCORE_URLS=http://+:8080
      # ğŸš© Ø§ÛŒÙ† Ù…Ù‡Ù…Ù‡: override Ú©Ø±Ø¯Ù† Ù‡Ù…ÙˆÙ† SinaRailway
      - ConnectionStrings__SinaRailway=Host=anbalya_postgres;Port=5432;Database=TourAntalya;Username=tourAntalya;Password=12sina122;Pooling=true;SSL Mode=Disable;
    ports:
      - "8081:8080"
volumes:
  anbalya_pgdata: